name: CICD

on:
  push:
    branches:
      - crawler
      - har-file
      - swagger
      - brokencrystals
      - With-Actions
  pull_request:
    branches: [With-Actions]
  schedule:
    - cron: "0 0 * * THU"

jobs:
  run_dast:
    name: Run super basic scan Action
    runs-on: ubuntu-20.04
    container: node:16
    steps:
      - name: Scan Start
        id: start
        uses: NeuraLegion/run-scan@release
        with:
          api_token: ${{ secrets.BRIGHT_TOKEN}}
          hostname: app.brightsec.com
          name: Project 32 Bright Actions Scan With Pipeline Wait1 - ${{ github.sha }}
          discovery_types: |
            [ "crawler" ]
          crawler_urls: |
            [ "https://brokencrystals.com" ]
          project_id: "ePB48tZH3KeGRHE6N2skAb"
      - name: Wait for breakpoint
        id: wait
        uses: NeuraLegion/wait-for@release
        with:
          api_token:  ${{ secrets.BRIGHT_TOKEN }}
          hostname: app.brightsec.com
          scan: ${{ steps.start.outputs.id }}
          wait_for: critical
          code_scanning_alerts: true
          github_token: ${{ secrets.ACTION_GITHUB_TOKEN }}
          timeout: 60000 # time in seconds
